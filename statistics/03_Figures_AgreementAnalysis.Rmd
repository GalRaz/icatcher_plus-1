---
title: "Supplemental Figures and LASSO regression on trial-by-trial agreement vs participant and video features"
author: "Shari Liu"
date: '2022-08-10'
output: html_document
---

# Overview
In this script, we produce a few supplemental plots, and we model the trial-by-trial accuracy of iCatcher (i.e. % agreement between iCatcher and a human rater), as predicted by an array of video and participant features, using lasso regression.

**Note**: The data required to reproduce this analysis is not open access, because it links individual participants' looking behavior to demographic data. 

## Features over all datasets
These are the per-trial or per-video features that are shared across all 3 datasets:

*Per-trial features:*

- Human-model agreement (% agreement, computed over frames; the thing we want to predict)
- Human-human agreement (same as above, but computed across two human raters)
- Model confidence (generated by iCatcher, averaged over frames within a trial)
- Average position of face (x, y)
- Standard deviation in location of face (i.e. face movement)
- Face density (i.e. # of pixels in face relative to size)

*Per-video features:*

- Child age in months (reported by parent, rounded to nearest month)
- Child gender (reported by parent)
- Child race and ethnicity (reported by parent) - reported differently across datasets
- Average luminance of video frames

## Features specific to Lookit
These are additional per-video features that are specific to the Lookit dataset:

- Skin tone (light, medium, dark)
- Eye color (light, dark)
- Did camera position or background move at all throughout experiment


```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

## load required packages
ipak <- function (pkg) {
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = TRUE)
  sapply(pkg, require, character.only = TRUE)
}

packages <- c("reticulate", "lme4", "lmerTest", "effects", "lsmeans", "tidyverse", "cowplot", "glmnet", "patchwork", "data.table", "MuMIn", "ggExtra", "effectsize", "viridis", "selectiveInference")

ipak(packages)

# set summed contrasts
options(contrasts = c("contr.treatment", "contr.poly")) 

#py_install("pandas")
source_python("pickle_reader.py")
pd <- import("pandas")

# fix bs with dplyr 
detach("package:dplyr", unload = TRUE)
library("dplyr")
sessionInfo()
```

```{r}
# function that converts lmm model summary to df
gen.m <- function(model) {
  df <- data.frame(coef(summary(model)))
  names(df) <- c("est", "se", "df", "t", "p")
  return(df)
}
```

# Read in data
```{r}
cal <- pd$read_pickle("metrics/metrics_cali-bw.p")
senegal <- pd$read_pickle("metrics/metrics_senegal.p")
lookit <- pd$read_pickle("metrics/metrics_lookit.p")

# set up empty dfs to be filled
cal.trial.df <- data.frame()
lookit.trial.df <- data.frame()
senegal.trial.df <- data.frame()

# produce trial-level dfs for each dataset

for (i in 1:length(cal)) {

  subj <- paste0("cal_", i)
  dataset <- "cal-bw"
  agemonths <- as.numeric(cal[i][[1]]$csv_info$child_age)
  race <- tolower(cal[i][[1]]$csv_info$child_race)
  gender <- tolower(cal[i][[1]]$csv_info$child_gender)
  luminance <- as.numeric(cal[i][[1]]$stats$luminance)
  
  # specific to cal-bw
  preterm <- as.logical(cal[i][[1]]$csv_info$child_preterm)

  # specific to lookit
  # camera_moved <- as.logical(lookit[i][[1]]$csv_info$camera_moved)
  # skin_tone <- tolower(lookit[i][[1]]$csv_info$child_skin_tone)
  # eye_color <- tolower(lookit[i][[1]]$csv_info$child_eye_color)
  camera_moved <- NA
  skin_tone <- NA
  eye_color <- NA

  n_trials <- length(cal[i][[1]]$human1_vs_machine_trials)
  for (j in 1:n_trials) {
      trial <- j
      hm_agreement <- cal[i][[1]]$human1_vs_machine_trials[[j]]$agreement
      hh_agreement <- cal[i][[1]]$human1_vs_human2_trials[[j]]$agreement
      confidence <- mean(cal[i][[1]]$human1_vs_machine_trials[[j]]$raw_confidence, na.rm=TRUE)
      face_density <- cal[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_pixel_density
      face_x <- cal[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_loc[1]
      face_y <- cal[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_loc[2]
      face_movement <- cal[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_loc_std
      cur_row <- data.frame(dataset, subj, agemonths, race, gender, luminance, preterm, camera_moved, skin_tone, eye_color, trial, hm_agreement, hh_agreement, confidence, face_density, face_x, face_y, face_movement)
      cal.trial.df <- rbind(cal.trial.df, cur_row)
  }
}

for (i in 1:length(lookit)) {

  subj <- paste0("lookit_", i)
  dataset <- "lookit"
  agemonths <- as.numeric(lookit[i][[1]]$csv_info$child_age)
  race <- tolower(lookit[i][[1]]$csv_info$child_race)
  gender <- tolower(lookit[i][[1]]$csv_info$child_gender)
  luminance <- as.numeric(lookit[i][[1]]$stats$luminance)
  # specific to cal-bw
  # preterm <- as.logical(cal[i][[1]]$csv_info$child_preterm)
  preterm <- NA
  
  # specific to lookit
  camera_moved <- lookit[i][[1]]$csv_info$camera_moved
  skin_tone <- tolower(lookit[i][[1]]$csv_info$child_skin_tone)
  eye_color <- tolower(lookit[i][[1]]$csv_info$child_eye_color)
  n_trials <- length(lookit[i][[1]]$human1_vs_machine_trials)
  
  for (j in 1:n_trials) {
      trial <- j
      hm_agreement <- lookit[i][[1]]$human1_vs_machine_trials[[j]]$agreement
      hh_agreement <- lookit[i][[1]]$human1_vs_human2_trials[[j]]$agreement
      face_density <- lookit[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_pixel_density
      confidence <- mean(lookit[i][[1]]$human1_vs_machine_trials[[j]]$raw_confidence, na.rm=TRUE)
      face_x <- lookit[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_loc[1]
      face_y <- lookit[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_loc[2]
      face_movement <- lookit[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_loc_std
      cur_row <- data.frame(dataset, subj, agemonths, race, gender, luminance, preterm, camera_moved, skin_tone, eye_color, trial, hm_agreement, hh_agreement, confidence, face_density, face_x, face_y, face_movement)
      lookit.trial.df <- rbind(lookit.trial.df, cur_row)
  }
}

for (i in 1:length(senegal)) {

  subj <- paste0("senegal_", i)
  dataset <- "senegal"
  n_trials <- length(senegal[i][[1]]$human1_vs_machine_trials)
  luminance <- as.numeric(senegal[i][[1]]$stats$luminance)

  agemonths <- as.numeric(senegal[i][[1]]$csv_info$child_age)
  race <- "black"
  gender <- tolower(senegal[i][[1]]$csv_info$child_gender)
  
  # specific to cal-bw
  # preterm <- as.logical(cal[i][[1]]$csv_info$child_preterm)
  preterm <- NA
  
  # specific to lookit
  # camera_moved <- as.logical(lookit[i][[1]]$csv_info$camera_moved)
  # skin_tone <- tolower(lookit[i][[1]]$csv_info$child_skin_tone)
  # eye_color <- tolower(lookit[i][[1]]$csv_info$child_eye_color)
  camera_moved <- NA
  skin_tone <- NA
  eye_color <- NA
  
  for (j in 1:n_trials) {
      trial <- j
      hm_agreement <- senegal[i][[1]]$human1_vs_machine_trials[[j]]$agreement
      hh_agreement <- senegal[i][[1]]$human1_vs_human2_trials[[j]]$agreement
      face_density <- senegal[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_pixel_density
      confidence <- mean(senegal[i][[1]]$human1_vs_machine_trials[[j]]$raw_confidence, na.rm=TRUE)      
      face_x <- senegal[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_loc[1]
      face_y <- senegal[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_loc[2]
      face_movement <- senegal[i][[1]]$human1_vs_machine_trials[[j]]$avg_face_loc_std
      cur_row <- data.frame(dataset, subj, agemonths, race, gender, preterm, luminance, camera_moved, skin_tone, eye_color, trial, hm_agreement, hh_agreement, confidence, face_density, face_x, face_y, face_movement)
      senegal.trial.df <- rbind(senegal.trial.df, cur_row)
  }
}

# bind them together and specify reference level for dataset
data.trial.df <- rbind(cal.trial.df, senegal.trial.df, lookit.trial.df) 
data.trial.df$dataset <- factor(data.trial.df$dataset, levels = c("cal-bw", "senegal", "lookit"))
data.trial.df$race <- relevel(factor(data.trial.df$race), ref = "white")
data.trial.df$camera_moved <- relevel(factor(data.trial.df$camera_moved), ref = "no")
data.trial.df$face_x <- data.trial.df$face_x-0.5 # normalize so that 0 = center
data.trial.df$face_y <- data.trial.df$face_y-0.5 # normalize so that 0 = center

# make z-scored version of trial-level dataset, and z score within each dataset
data.trial.df.scaled <- data.trial.df %>%
  group_by(dataset) %>%
  mutate_at(vars("hm_agreement", "hh_agreement", "confidence", "luminance", "face_density", "face_x", "face_y", "face_movement", "agemonths"), scale)
```

```{r}
# summarize number of videos in each dataset
videos_per_dataset <- data.trial.df %>%
  group_by(dataset) %>%
  summarise(videos_per_dataset = length(unique(subj)))

# summarize number of observations present and missing
trials_per_video <- data.trial.df %>%
  group_by(dataset, subj) %>%
  summarise(total_trials_per_video = n())


trials_missing_per_video <- data.trial.df %>%
  group_by(dataset, subj) %>%
  filter(hm_agreement == "NaN" | hh_agreement == "NaN") %>%
  summarise(trials_missing_per_video = n())

trials_per_dataset <- trials_per_video %>%
  group_by(dataset) %>%
  summarise(trials_per_dataset = sum(total_trials_per_video))


trials_missing_per_dataset <- trials_missing_per_video %>%
  group_by(dataset) %>%
  summarise(trials_missing_per_dataset = sum(trials_missing_per_video))

summary <- full_join(full_join(full_join(videos_per_dataset, trials_per_video), trials_missing_per_dataset),trials_per_dataset)

summary_trials <- summary %>%
  select(dataset, trials_per_dataset, trials_missing_per_dataset) %>%
  unique() %>%
  mutate(trials_per_dataset_after_missing = trials_per_dataset - trials_missing_per_dataset)
  
```

Note: Missing values for Senegal are to be expected, because human-human agreement is only available for ~half of trials per video.

```{r}
knitr::kable(summary_trials)
knitr::kable(summary)
```

# Plots
```{r fig.height=12}
theme_set(theme_cowplot(12))
palette1 <- scale_fill_manual(values=c("#1590df", "#a675b4", "#57e345"))
palette2 <- scale_color_manual(values=c("#1590df", "#a675b4", "#57e345"))
```

## Features
```{r}

hm <- ggplot(data.trial.df, aes(dataset, hm_agreement, fill = dataset)) +
  geom_boxplot(outlier.alpha = 0) +
  geom_jitter(width = .05, height=0, alpha=.2) +
  stat_summary(geom = "errorbar", fun.data = "mean_se", colour = "white", width = .1) +
  stat_summary(geom = "point", fun.data = "mean_se", colour = "white") +
  ylab("% agreement, human vs model") +
  theme(legend.position = "none") +
  palette1 +
  palette2

```

```{r}
hh <- ggplot(data.trial.df, aes(dataset, hh_agreement, fill = dataset)) +
  geom_boxplot(outlier.alpha = 0) +
  geom_jitter(width = .1, height=0, alpha=.2) +
  stat_summary(geom = "errorbar", fun.data = "mean_se", colour = "white", width = .1) +
  stat_summary(geom = "point", fun.data = "mean_se", colour = "white") +
  ylab("% agreement, human vs human")+
  theme(legend.position = "none") +
  palette1 +
  palette2

```

```{r}
hm_hh <- ggplot(data.trial.df, aes(hh_agreement, hm_agreement, colour = dataset)) +
  # geom_boxplot(outlier.alpha = 0) +
  geom_point(width = .1, height=0, alpha=.5, aes(shape=dataset)) +
  geom_smooth() +
  ylab("% agreement, human vs model")+
  xlab("% agreement, human vs human")+
  theme(legend.position = "none") + 
  palette1 +
  palette2
```

```{r}
hm_confidence <- ggplot(data.trial.df, aes(confidence, hm_agreement, colour = dataset)) +
  # geom_boxplot(outlier.alpha = 0) +
  geom_point(alpha=.3, aes(shape=dataset)) +
  geom_smooth() +
  ylab("% agreement, human vs model")+
  xlab("Model confidence")+
  theme(legend.position = "none") +
  palette1 +
  palette2 +
  theme_cowplot(16)

```

```{r}
fd <- ggplot(data.trial.df, aes(dataset, face_density, fill = dataset)) +
  geom_boxplot(outlier.alpha = 0) +
  geom_jitter(width = .1, height=0, alpha=.2) +
  stat_summary(geom = "errorbar", fun.data = "mean_se", colour = "white", width = .1) +
  stat_summary(geom = "point", fun.data = "mean_se", colour = "white") +  
  ylab("Face density")+
  theme(legend.position = "none") +
  palette1 +
  palette2

```

```{r}
fx <- ggplot(data.trial.df, aes(dataset, face_x, fill = dataset)) +
  geom_boxplot(outlier.alpha = 0) +
  geom_jitter(width = .1, height=0, alpha=.2) +
  stat_summary(geom = "errorbar", fun.data = "mean_se", colour = "white", width = .1) +
  stat_summary(geom = "point", fun.data = "mean_se", colour = "white") +
  ylab("Face position relative to center (horizontal)") +
  coord_cartesian(ylim = c(-.4, .4)) +
  theme(legend.position = "none") +
  palette1 +
  palette2

```

```{r}
fx.accuracy <- ggplot(data.trial.df, aes(face_x, hm_agreement, colour = dataset)) +
  geom_point(width = .1, alpha=.2) +
  xlab("Face position relative to center (horizontal)") +
  geom_smooth() + 
  theme(legend.position = "none") +
  palette1 +
  palette2
```

```{r}
fy.accuracy <- ggplot(data.trial.df, aes(face_y, hm_agreement, colour = dataset)) +
  geom_point(width = .1, alpha=.2) +
  xlab("Face position relative to center (vertical)") +
  geom_smooth() + 
  theme(legend.position = "none") +
  palette1 +
  palette2
```


```{r}
fy <- ggplot(data.trial.df, aes(dataset, face_y , fill = dataset)) +
  geom_boxplot(outlier.alpha = 0) +
  geom_jitter(width = .1, height=0, alpha=.2) +
  stat_summary(geom = "errorbar", fun.data = "mean_se", colour = "white", width = .1) +
  stat_summary(geom = "point", fun.data = "mean_se", colour = "white") +
  ylab("Face position relative to center (vertical)") +
  coord_cartesian(ylim = c(-.4, .4)) +
  theme(legend.position = "none") +
  palette1 +
  palette2
```

```{r}
xy_summary <- data.trial.df %>%
  group_by(dataset) %>%
  summarise(face_x_mean = mean(face_x, na.rm=TRUE),
            face_y_mean = mean(face_y, na.rm=TRUE),
            face_x_se = sd(face_x, na.rm=TRUE)/sqrt(n()),
            face_y_se = sd(face_x, na.rm=TRUE)/sqrt(n()))

fxy <- ggplot(data.trial.df, aes(face_x, face_y, colour = dataset)) +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", colour = "white", contour_var = "ndensity")  +
  # geom_hex(bins=30)+
  scale_fill_viridis(option="magma")+
  geom_point(data = xy_summary, aes(x = face_x_mean, y = face_y_mean),
                colour = "white", shape = "diamond", size = 5) +
  geom_rug(alpha = .1) +
  xlab("Face position relative to center (horizontal)") +
  ylab("Face position relative to center (vertical)") +
  coord_cartesian(ylim = c(-.4, .4), xlim = c(-.4, .4)) +
  facet_wrap(~dataset) +
  theme(legend.position = "none") +
  palette2 
```

```{r}
fm <- ggplot(data.trial.df, aes(dataset, face_movement, fill = dataset)) +
  geom_boxplot(outlier.alpha = 0) +
  geom_jitter(width = .1, height=0, alpha=.2) +
  stat_summary(geom = "errorbar", fun.data = "mean_se", colour = "white", width = .1) +
  stat_summary(geom = "point", fun.data = "mean_se", colour = "white") +
  ylab("Face movement") +
  theme(legend.position = "none") +
  palette1 +
  palette2
```

```{r, fig.height=8, fig.width=12}
row1 <- (hm | hh | hm_hh | hm_confidence) 
row2 <- (fd | fm | fxy) + plot_layout(widths = c(1, 1, 3))

(row1 / row2) + plot_annotation(tag_levels = c('A', '1'))
```

## Breakdown of frames for training
```{r}
training_info <- read.csv(file = "training_data_info.csv", header = TRUE) %>%
  select(-total) %>%
  pivot_longer(cols = c(frames_used:other), names_to = "Category", values_to = "Percentage")

training_info$Category <- factor(training_info$Category, levels = rev(c("frames_used", "rolling_window", "face_classifier", "coders_disagree", "other")))

training_info$dataset <- factor(training_info$dataset, levels = rev(c("cal-bw", "senegal", "lookit")))
levels(training_info$dataset) <- c("Cal-BW", "Senegal", "Lookit")
  
ggplot(training_info, aes(x = dataset, fill = Category, y = Percentage, label = paste0(Percentage, '%'))) +
  # geom_bar(position = "fill", stat = "identity") +
  geom_col() +
  xlab("Dataset") +
  geom_text(position = position_stack(vjust = 0.5)) +
  theme_cowplot(20) +
  scale_fill_brewer(palette = 10)
```

# Results per dataset

## (1) Cal-BW

```{r}
# use only complete observations
caldata <- data.trial.df %>%
  select(-camera_moved, -skin_tone, -eye_color) %>%
  drop_na() 

caldata.z <- caldata %>%
  mutate_at(vars("hm_agreement", "hh_agreement", "confidence", "luminance", "face_density", "face_x", "face_y", "face_movement", "agemonths"), scale) %>%
  as.data.frame()

calpredictors <- sort(c('hh_agreement', 'confidence', 'face_density', 'face_x', 'face_y', 'face_movement', 'agemonths', 'gender', 'race', 'subj', 'luminance', 'preterm'))
caly <- caldata.z$hm_agreement
calx <- data.matrix(caldata.z[, calpredictors]) # only common predictors
dim(calx)
length(caly)
```

```{r}
calsigma <- estimateSigma(calx, caly)$sigmahat
calfit <- lar(calx, caly, maxsteps=20)
caloutput <- larInf(calfit, 
       sigma = calsigma,
       type = "aic",
       ntimes= 1,
       alpha = .05)

index <- caloutput$vars
names <- calpredictors[caloutput$vars]

cbind(index, names)

caloutput
```


## (2) Senegal
```{r}
sendata <- data.trial.df %>%
  filter(dataset == "senegal") %>%
  select(-camera_moved, -skin_tone, -eye_color, -race, -preterm) %>% # only take vars that are present and that actually vary
  drop_na()

sendata.z <- sendata %>%
  mutate_at(vars("hm_agreement", "hh_agreement", "confidence", "luminance", "face_density", "face_x", "face_y", "face_movement", "agemonths"), scale)

senpredictors <- sort(c('hh_agreement', 'confidence', 'face_density', 'face_x', 'face_y', 'face_movement', 'agemonths', 'gender', 'subj', 'luminance'))
seny <- sendata.z$hm_agreement
senx <- data.matrix(sendata.z[, senpredictors]) # only common predictors
dim(senx)
length(seny)
```

```{r}
sensigma <- estimateSigma(senx, seny)$sigmahat
senfit <- lar(senx, seny, maxsteps=20)
senoutput <- larInf(senfit, 
       sigma = sensigma,
       type = "aic",
       ntimes= 1,
       alpha = .05)

index <- senoutput$vars
names <- senpredictors[senoutput$vars]

cbind(index, names)

senoutput
```


## (3) Lookit
```{r}
# use only complete observations
lookitdata <- data.trial.df %>%
  filter(dataset == "lookit") %>%
  select(-preterm) %>% # only take vars that are present
  drop_na()
dim(lookitdata)

lookitdata.z <- lookitdata %>%
  mutate_at(vars("hm_agreement", "hh_agreement", "confidence", "face_density", "face_x", "face_y", "face_movement", "agemonths", "luminance"), scale)

lookitpredictors <- sort(c('hh_agreement', 'confidence', 'face_density', 'face_x', 'face_y', 'face_movement', "camera_moved", "skin_tone", "eye_color", "agemonths", "race", "gender", "subj", "luminance"))

lookity <- lookitdata.z$hm_agreement
lookitx <- data.matrix(lookitdata.z[, lookitpredictors]) # assess race per dataset
dim(lookitx)
length(lookity)
```

```{r}
lookitsigma <- estimateSigma(lookitx, lookity)$sigmahat
lookitfit <- lar(lookitx, lookity, maxsteps=20)
lookitoutput <- larInf(lookitfit, 
       sigma = lookitsigma,
       type = "aic",
       ntimes= 1,
       alpha = .05)

index <- lookitoutput$vars
names <- lookitpredictors[lookitoutput$vars]

cbind(index, names)

lookitoutput
```

# Results: All datasets together
```{r}
# use only complete observations
data <- data.trial.df %>%
  select(-camera_moved, -preterm, -skin_tone, -eye_color) %>% # only take vars that are present in all 3
  drop_na() %>%
  mutate(race = case_when(race == "white" ~ "white",
                          race == "white only" ~ "white",
                          TRUE ~ "non-white")) # because of differences in race coding, convert

data.z <- data %>%
  mutate_at(vars("hm_agreement", "hh_agreement", "confidence", "face_density", "face_x", "face_y", "face_movement", "agemonths", "luminance"), scale)

allpredictors <- sort(c('dataset', 'hh_agreement', 'confidence', 'face_density', 'face_x', 'face_y', 'face_movement', 'agemonths', 'gender', 'race', 'subj', 'luminance'))
y <- data.z$hm_agreement
x <- data.matrix(data.z[, allpredictors]) # only common predictors
dim(x)
length(y)
```

```{r}
sigma <- estimateSigma(x, y)$sigmahat
fit <- lar(x, y, maxsteps=20)
output.all <- larInf(fit, 
       sigma = estimateSigma(x, y)$sigmahat,
       type = "aic",
       ntimes = 1,
       alpha = .05)

index <- output.all$vars
names <- allpredictors[output.all$vars]

cbind(index, names)

output.all
```


### "Best" model explained variance

*WARNING*: The coefficients, p values, etc of these lme4 models should not be interpreted, because they do not take into account the fact that we did variable selection beforehand. The main value of interest is the conditional R^2 of the two models.

```{r}
options(contrasts = c("contr.treatment", "contr.poly")) 

data.z <- data.trial.df %>%
  select(-camera_moved, -skin_tone, -eye_color, -preterm) %>%
  mutate_at(vars("hm_agreement", "hh_agreement", "confidence", "face_density", "face_x", "face_y", "face_movement", "agemonths", "luminance"), scale) %>%
  mutate(race = case_when(race == "white" ~ "white",
                          race == "white only" ~ "white",
                          TRUE ~ "non-white")) %>% # because of differences in race coding, convert
  drop_na()

data.z$race <- factor(data$race, levels = c("white", "non-white"))

model.all <- lmer(hm_agreement ~ confidence + hh_agreement + dataset + face_x + face_y + agemonths + luminance + (1|subj),
            data = data.z,
            REML = FALSE)

r.squaredGLMM(model.all)
summary(model.all)
sjPlot::tab_model(model.all)
sjPlot::plot_model(model.all, type = "est", show.values = TRUE, sort.est = TRUE, axis.lim = c(-1,2), show.p = TRUE, digits = 3)
```


```{r}
model.smaller <- lmer(hm_agreement ~ confidence + (1|subj),
            data = data.z,
            REML = FALSE)

r.squaredGLMM(model.smaller)
summary(model.smaller)
sjPlot::tab_model(model.smaller)
```

```{r}
anova(model.smaller, model.all)
```
